[env]
RUN_BASE = "uv run src/icu_learn1"
TRIVY_IGNORE = "--skip-dirs ./tmp,./xml"

[tasks]
ex1 = "${RUN_BASE}/ex1.py"
ex2 = "${RUN_BASE}/ex2.py"
ex1b = "${RUN_BASE}/ex1b.py"
ex2b = "${RUN_BASE}/ex2b.py"
ex3 = "${RUN_BASE}/ex3.py"
ex3b = "${RUN_BASE}/ex3b.py"

# ======== utils
format.shell = """
ruff format &&
# biome format --write . &&
dprint fmt --config ~/dprint.json &&
textlint --fix "**/*.md"
"""

check = "ruff check ./src"
mypy = "mypy src"

update.shell = "uv lock -U && uv sync && uv cache prune"

uvsync = "uv sync"
requirements = "uv pip compile pyproject.toml --no-deps -o requirements.txt"
sync = ["uvsync", "requirements"]

trivy-config = "trivy config ."
trivy-fs = "trivy fs ${TRIVY_IGNORE} ."
trivy-check = ["trivy-config", "trivy-fs"]
trivy = ["trivy-check"]
trivy-license = "trivy fs ${TRIVY_IGNORE} --scanners license --severity HIGH,CRITICAL ."
trivy-sbom = "trivy fs ${TRIVY_IGNORE} --scanners vuln --format cyclonedx --output sbom.cdx.json ."
trivy-sbom-spdx = "trivy fs ${TRIVY_IGNORE} --scanners vuln --format spdx-json --output sbom.spdx.json ."
sbom = ["requirements", "trivy-sbom", "trivy-sbom-spdx"]
